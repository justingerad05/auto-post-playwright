name: Medium Auto Post

on:
  workflow_dispatch:

jobs:
  post:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Install Playwright browsers
        run: npx playwright install --with-deps chromium

      - name: Create profile folder
        run: mkdir -p profile

      - name: Download Medium profile ZIP
        run: |
          echo "Downloading profile..."
          curl -L -o profile.zip \
            https://raw.githubusercontent.com/justingerad05/auto-post-playwright/main/medium-profile.zip

      - name: Extract Medium profile
        run: |
          unzip profile.zip -d profile
          ls -R profile

      - name: Run Medium poster
        env:
          PROFILE_PATH: ./profile
        run: |
          set -o pipefail
          node index.js || {
            echo "ðŸ“¸ Capturing screenshot for debugging..."
            mkdir -p screenshots

            node -e "
              const { chromium } = require('playwright');
              (async () => {
                const b = await chromium.launch();
                const p = await b.newPage();
                await p.goto('https://example.com');
                await p.screenshot({ path: 'screenshots/failure.png', fullPage: true });
                await b.close();
              })();
            "

            exit 1
          }

      - name: Upload debug screenshots
        uses: actions/upload-artifact@v4
        with:
          name: debug-screenshots
          path: screenshots
